within ComputerCooling.OnePhaseLiquidComponents.FlowControl.Valves;

model ValveModulating_TwoPort
  extends OnePhaseLiquidComponents.BaseClasses.TwoPorts_pwh;
  replaceable model medium = Media.SubCooledWater_Incompressible;
  medium m;
  
  parameter PressureDifference dp_nom = 5e4 "nominal pressure difference at w_nom and cmd = 1";
  parameter MassFlowRate w_nom = 1 "nominal mass flow rate at dp_nom and cmd = 1";
  Modelica.Blocks.Interfaces.RealInput cmd annotation(
    Placement(visible = true, transformation(origin = {-100, 70}, extent = {{-20, -20}, {20, 20}}, rotation = 0), iconTransformation(origin = {2, 118}, extent = {{-20, -20}, {20, 20}}, rotation = -90)));
protected
  final parameter Real kv = w_nom / ComputerCooling.Functions.sqrtReg(dp_nom) annotation(Evaluate = true);
  
equation
  //liquid coordinates
  m.p = pwh_a.p;
  m.h = pwh_a.h;
  
  //modulated flow
  w = ComputerCooling.Functions.Clamp(cmd) * kv * ComputerCooling.Functions.sqrtReg(dp);
  
  hoa = hib;  //no change in enthalpy
  hob = hia;

annotation(
    Icon(graphics = {Bitmap(extent = {{-100, -100}, {100, 100}}, imageSource = "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")}));
end ValveModulating_TwoPort;


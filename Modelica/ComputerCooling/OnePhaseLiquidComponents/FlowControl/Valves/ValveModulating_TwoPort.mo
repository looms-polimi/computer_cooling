within ComputerCooling.OnePhaseLiquidComponents.FlowControl.Valves;

model ValveModulating_TwoPort
  extends OnePhaseLiquidComponents.BaseClasses.TwoPorts_pwh;
  
  parameter PressureDifference dp_nom = 5e4 "nominal pressure difference at w_nom and cmd = 1";
  parameter MassFlowRate w_nom = 1 "nominal mass flow rate at dp_nom and cmd = 1";
  Modelica.Blocks.Interfaces.RealInput cmd annotation(
    Placement(visible = true, transformation(origin = {-100, 70}, extent = {{-20, -20}, {20, 20}}, rotation = 0), iconTransformation(origin = {0, 100}, extent = {{-20, -20}, {20, 20}}, rotation = -90)));
protected
  final parameter Real kv = w_nom / ComputerCooling.Functions.sqrtReg(dp_nom) annotation(Evaluate = true);
  
equation
//modulated flow
  w = if cmd <= 0 then 1e-6 else ComputerCooling.Functions.Clamp(cmd) * kv * ComputerCooling.Functions.sqrtReg(dp);
  
  hoa = hib;
//no change in enthalpy
  hob = hia;

annotation(
    Icon(graphics = {Text(origin = {0, -65}, extent = {{-60, 13}, {60, -13}}, textString = "Modulating"), Bitmap(origin = {0, 14}, extent = {{-100, -66}, {100, 66}}, imageSource = "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")}));
end ValveModulating_TwoPort;
